<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Breathwork Timer</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Arial, sans-serif;
            background: #FFFCF0;
            color: #282726;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            padding: 15px;
        }

        .container {
            width: 100%;
            max-width: 320px;
            text-align: center;
        }

        .circle-container {
            height: 200px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 15px;
            position: relative;
        }

        .outline {
            width: 180px;
            height: 180px;
            border-radius: 50%;
            border: 2px solid #CECDC3;
            position: absolute;
        }

        .circle {
            width: 0px;
            height: 0px;
            border-radius: 50%;
            background: rgba(0, 86, 59, 0.3);
            transition: all 0.3s ease;
            position: relative;
        }

        .phase-label {
            font-size: 20px;
            margin-bottom: 8px;
            min-height: 24px;
        }

        .timer {
            font-size: 36px;
            font-weight: bold;
            margin-bottom: 15px;
            min-height: 45px;
            color: rgba(0, 86, 59, 0.5);
        }

        .controls {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-bottom: 15px;
        }
        
        .control-group {
            text-align: left;
        }
        
        label {
            display: block;
            font-size: 12px;
            margin-bottom: 4px;
            color: #6F6E69;
        }

        input {
            width: 100%;
            padding: 8px;
            font-size: 14px;
            border: 1px solid #CECDC3;
            border-radius: 5px;
            background: #F2F0E5;
            color: #282726;
        }

        button {
            width: 100%;
            padding: 12px;
            font-size: 16px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            background: rgba(0, 86, 59, 0.3);
            color: #6F6E69;
            transition: background 0.2s;
        }

        button:hover {
            background: rgba(0, 86, 59, 0.4);
            color: #575653;
        }

        button.stop {
            background: rgba(175, 48, 41, 0.3);
            color: #6F6E69;
        }

        button.stop:hover {
            background: rgba(175, 48, 41, 0.4);
            color: #575653;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="circle-container">
            <div class="outline"></div>
            <div class="circle" id="circle"></div>
        </div>
        
        <div class="phase-label" id="phaseLabel"></div>
        <div class="timer" id="timer"></div>
        
        <div style="margin-bottom: 12px;">
            <label style="display: inline-flex; align-items: center; cursor: pointer; font-size: 14px;">
                <input type="checkbox" id="showTimer" style="width: auto; margin-right: 8px;">
                Show timer
            </label>
        </div>
        
        <div class="controls">
            <div class="control-group">
                <label>Inhale (s)</label>
                <input type="number" id="inhale" value="4" min="1" max="20">
            </div>
            <div class="control-group">
                <label>Hold (s)</label>
                <input type="number" id="pauseInhale" value="4" min="0" max="20">
            </div>
            <div class="control-group">
                <label>Exhale (s)</label>
                <input type="number" id="exhale" value="4" min="1" max="20">
            </div>
            <div class="control-group">
                <label>Hold (s)</label>
                <input type="number" id="pauseExhale" value="4" min="0" max="20">
            </div>
        </div>
        
        <button id="toggleBtn">Start</button>
    </div>

    <script is:inline>
        let isRunning = false;
        let currentPhase = 0;
        let phaseTimeout;
        let timerInterval;
        let phaseStartTime;
        let phaseDuration;

        const circle = document.getElementById('circle');
        const phaseLabel = document.getElementById('phaseLabel');
        const timerDisplay = document.getElementById('timer');
        const toggleBtn = document.getElementById('toggleBtn');
        const showTimerCheckbox = document.getElementById('showTimer');

        // Load saved settings from localStorage
        const loadSettings = () => {
            const saved = localStorage.getItem('breathworkSettings');
            if (saved) {
                const settings = JSON.parse(saved);
                document.getElementById('inhale').value = settings.inhale || 4;
                document.getElementById('pauseInhale').value = settings.pauseInhale || 4;
                document.getElementById('exhale').value = settings.exhale || 4;
                document.getElementById('pauseExhale').value = settings.pauseExhale || 4;
                showTimerCheckbox.checked = settings.showTimer || false;
            }
        };

        // Save settings to localStorage
        const saveSettings = () => {
            const settings = {
                inhale: parseInt(document.getElementById('inhale').value),
                pauseInhale: parseInt(document.getElementById('pauseInhale').value),
                exhale: parseInt(document.getElementById('exhale').value),
                pauseExhale: parseInt(document.getElementById('pauseExhale').value),
                showTimer: showTimerCheckbox.checked
            };
            localStorage.setItem('breathworkSettings', JSON.stringify(settings));
        };

        // Load settings on page load
        loadSettings();

        const phases = [
            { name: 'Inhale', size: 180, getValue: () => parseInt(document.getElementById('inhale').value) },
            { name: 'Hold', size: 180, getValue: () => parseInt(document.getElementById('pauseInhale').value) },
            { name: 'Exhale', size: 0, getValue: () => parseInt(document.getElementById('exhale').value) },
            { name: 'Hold', size: 0, getValue: () => parseInt(document.getElementById('pauseExhale').value) }
        ];
        
        function updateTimer() {
            if (!isRunning || !showTimerCheckbox.checked) {
                timerDisplay.textContent = '';
                return;
            }
            
            const elapsed = (Date.now() - phaseStartTime) / 1000;
            const remaining = Math.max(0, phaseDuration - elapsed);
            timerDisplay.textContent = Math.ceil(remaining);
            
            if (remaining > 0) {
                requestAnimationFrame(updateTimer);
            }
        }
        
        function runPhase(index) {
            if (!isRunning) return;
            
            const phase = phases[index];
            const duration = phase.getValue();
            
            if (duration === 0 && (index === 1 || index === 3)) {
                currentPhase = (index + 1) % 4;
                runPhase(currentPhase);
                return;
            }
            
            phaseLabel.textContent = phase.name;
            circle.style.width = phase.size + 'px';
            circle.style.height = phase.size + 'px';
            circle.style.transition = `all ${duration}s ease`;
            
            phaseStartTime = Date.now();
            phaseDuration = duration;
            
            if (showTimerCheckbox.checked) {
                updateTimer();
            }
            
            phaseTimeout = setTimeout(() => {
                currentPhase = (index + 1) % 4;
                runPhase(currentPhase);
            }, duration * 1000);
        }
        
        function toggle() {
            if (isRunning) {
                stop();
            } else {
                start();
            }
        }
        
        function start() {
            isRunning = true;
            currentPhase = 0;
            toggleBtn.textContent = 'Stop';
            toggleBtn.classList.add('stop');
            runPhase(0);
        }
        
        function stop() {
            isRunning = false;
            clearTimeout(phaseTimeout);
            toggleBtn.textContent = 'Start';
            toggleBtn.classList.remove('stop');
            phaseLabel.textContent = '';
            timerDisplay.textContent = '';
            circle.style.width = '0px';
            circle.style.height = '0px';
            circle.style.transition = 'all 0.3s ease';
        }
        
        showTimerCheckbox.addEventListener('change', () => {
            if (isRunning) {
                if (showTimerCheckbox.checked) {
                    updateTimer();
                } else {
                    timerDisplay.textContent = '';
                }
            }
            saveSettings();
        });

        // Save settings when inputs change
        document.getElementById('inhale').addEventListener('change', saveSettings);
        document.getElementById('pauseInhale').addEventListener('change', saveSettings);
        document.getElementById('exhale').addEventListener('change', saveSettings);
        document.getElementById('pauseExhale').addEventListener('change', saveSettings);

        toggleBtn.addEventListener('click', toggle);
    </script>
</body>
</html>
